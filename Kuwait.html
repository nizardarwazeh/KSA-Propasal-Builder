<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Proposal Builder – KSA</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- SweetAlert2 for styled alerts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  body{font-family:system-ui,Arial,sans-serif;background:#f9fafb;margin:0;padding:40px;color:#222;display:flex;justify-content:center}
  .wrapper{display:flex;gap:28px;width:95%;max-width:1300px}
  .container{flex:1.3;background:#fff;border-radius:12px;box-shadow:0 2px 12px rgba(0,0,0,.06);padding:24px 32px 36px}
  .results-panel{flex:1.7;background:#f7fafc;border-radius:12px;padding:24px 24px 30px;box-shadow:0 2px 12px rgba(0,0,0,.06);position:sticky;top:40px;height:fit-content}
  h1{text-align:left;color:#007b83;margin-bottom:10px;font-size:26px;font-weight:700}
  .top-actions{text-align:right;margin-bottom:20px}
  .btn{background:#007b83;color:#fff;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-size:14px}
  .btn:hover{background:#006a70}
  table{width:100%;border-collapse:collapse;margin-bottom:16px}
  td,th{padding:8px 10px;vertical-align:middle}
  td:first-child{font-weight:600;width:200px}
  input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc;font-size:14px}
  input[readonly],input[disabled]{background:#f1f1f1;color:#555;cursor:not-allowed}
  .inline-input{display:flex;gap:6px;align-items:center}
  .inline-input input[type="text"]{flex:1}
  .discount-text{flex:.7;text-align:center;font-weight:600;color:#007b83;font-size:13px;white-space:nowrap}
  .section-title{background:#e8f4f4;padding:8px;border-radius:8px;margin-top:18px;font-weight:700;color:#006a70}
  .results-panel h2{color:#007b83;margin-top:0}
  .results-panel p{font-size:15px;margin:8px 0;line-height:1.4}
  .results-panel strong{display:inline-block;width:220px;font-weight:600}
  #totalWithoutVat{display:inline-block;margin-top:4px}
  .spaced{margin-top:12px;border-top:1px solid #ddd;padding-top:8px}
  .price-table{width:100%;border-collapse:collapse;font-size:13px;margin-top:6px}
  .price-table th{text-align:center;background:#e8f4f4;color:#007b83;padding:6px;border-bottom:1px solid #ddd}
  .price-table td{text-align:center;padding:6px;border-bottom:1px solid #eee}
  .price-table td:first-child{text-align:left;font-weight:600;color:#333}
  .low-total{color:#c0392b;font-weight:700;}
  .high-total{color:#16a34a;font-weight:700;}
  #implLine{display:none;}
  @media(max-width:900px){.wrapper{flex-direction:column}.results-panel{position:relative;top:auto}}
</style>
</head>

<body>
<div class="wrapper">

  <!-- LEFT SIDE -->
  <div class="container">
    <h1>Proposal Builder</h1>

    <div class="top-actions">
      <button class="btn" id="resetBtn">Reset</button></div>

    <table>
      <tr>
        <td>Country</td>
        <td><select id="country"><option>Saudi Arabia</option><option>UAE</option><option>Qatar</option><option>Bahrain</option><option selected>Kuwait</option><option>Oman</option><option>Jordan</option><option>Iraq</option><option>Egypt</option></select></td>
      </tr>

      <tr>
        <td>ZenHR Bundle</td>
        <td>
          <select id="bundleZenHR">
            <option selected>Value</option>
            <option>Advanced</option>
          </select>
        </td>
      </tr>

      <tr>
        <td>ZenATS Bundle</td>
        <td>
          <select id="bundleZenATS">
            <option selected>None</option>
            <option>Starter</option>
            <option>Value</option>
            <option>Advanced</option>
          </select>
        </td>
      </tr>

      <tr>
        <td>No. of Employees</td>
        <td><input id="employees" type="text" min="1" placeholder="Enter employees (min 20)"></td>
      </tr>
    </table>

    <div class="section-title">Check Your Proposal</div>

    <table>
      <tr>
        <td>ZenHR Price (USD)</td>
        <td>
          <div class="inline-input">
            <input id="hrPrice" type="text" step="0.01" disabled>
            <span id="hrDisc" class="discount-text">00.00%</span></div>
        </td>
      </tr>

      <tr>
        <td>ZenPE Price (USD)</td>
        <td>
          <div class="inline-input">
            <input id="pePrice" type="text" step="0.01" disabled>
            <span id="peDisc" class="discount-text">00.00%</span></div>
        </td>
      </tr>

      <tr id="atsRow">
        <td>ZenATS Price (USD)</td>
        <td>
          <div class="inline-input">
            <input id="atsPrice" type="text" step="1" disabled>
            <span id="atsDisc" class="discount-text">00.00%</span></div>
        </td>
      </tr>

      <tr>
        <td>PS Fees (USD)</td>
        <td>
          <div class="inline-input">
            <input id="psFees2" type="text" step="1" disabled>
            <span id="psDisc" class="discount-text">00.00%</span></div>
        </td>
      </tr>
    </table></div>

  <!-- RIGHT SIDE -->
  <div class="results-panel">
    <h2>Summary</h2>
<img src="https://nizardarwazeh.github.io/Propasal-Builder/Kuwait.png" style="width:130px;float:right;margin-top:-55px;margin-right:8px;opacity:0.82;">
    <p><strong>Monthly Subscription:</strong> <span id="monthlySub">USD 0.00</span></p>
    <p><strong>Yearly Subscription:</strong> <span id="yearlySub">USD 0.00</span></p>
    <p id="implLine"><strong>Implementation Fees:</strong> <span id="implAmount">USD 0.00</span></p>
    <p id="atsLine" style="display:none;"><strong>ZenATS Fees:</strong> <span id="atsAmount">USD 0.00</span></p>
    <p style="display:none;"><strong>VAT Amount:</strong> <span id="vatAmount">USD 0.00</span></p>
    <p style="display:none;"><strong>Total Amount with VAT:</strong> <span id="totalWithVat">USD 0.00</span></p>
    <p class="spaced"><strong>Total Amount:</strong> <span id="totalWithoutVat">USD 0.00</span></p>

    <h2 style="margin-top:25px">Price Ranges</h2>

    <table class="price-table">
      <thead>
        <tr>
          <th>Feature</th>
          <th>Min</th>
          <th>Max</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>ZenHR (PPU)</td><td id="hrMinCell">0.00</td><td id="hrMaxCell">0.00</td></tr>
        <tr><td>ZenPE (PPU)</td><td id="peMinCell">0.00</td><td id="peMaxCell">0.00</td></tr>
        <tr><td>ZenATS (Yearly)</td><td id="atsMinCell">0.00</td><td id="atsMaxCell">0.00</td></tr>
        <tr><td>Implementation</td><td id="implMinCell">0.00</td><td id="implMaxCell">0.00</td></tr>
      </tbody>
    </table></div></div><script>
const VAT = 0;
const fmt = n => (+n).toLocaleString('en-US',{minimumFractionDigits:2,maximumFractionDigits:2});
const $ = id => document.getElementById(id);

// Disable or enable the proposal inputs
const inputsLock = locked => ["hrPrice","pePrice","atsPrice","psFees2"]
  .forEach(id => $(id).disabled = locked);

// Clear discount labels
function clearDiscounts() {
  ["hrDisc","peDisc","atsDisc","psDisc"].forEach(id => $(id).textContent = "00.00%");
}

// =====================
// GET RANGE FUNCTIONS
// =====================

function getZenATSRange(b){
  const t = {
    "None":      {min:0, max:0},
    "Starter":   {min:1000,  max:1333.33},
    "Value":     {min:3000,  max:4000},
    "Advanced":  {min:6000,  max:8000}
  };
  return t[b] || {min:0,max:0};
}



function getImplementationRange(e,b){
  const t = {
    Value: [
      {minEmp:20,maxEmp:50,   min:0,       max:400},
      {minEmp:51,maxEmp:100,  min:0,       max:1300},
      {minEmp:101,maxEmp:250, min:1333.33, max:2666},
      {minEmp:251,maxEmp:500, min:2666.67, max:5332},
      {minEmp:501,maxEmp:1000,min:4000,    max:8000}
    ],
    Advanced: [
      {minEmp:20,maxEmp:50,   min:0,       max:500},
      {minEmp:51,maxEmp:100,  min:0,       max:1500},
      {minEmp:101,maxEmp:250, min:2000,    max:4000},
      {minEmp:251,maxEmp:500, min:4000,    max:8000},
      {minEmp:501,maxEmp:1000,min:5333.33, max:10666}
    ]
  };

  const arr = t[b] || [];
  return arr.find(r => e >= r.minEmp && e <= r.maxEmp) || {min:0,max:0};
}

function getRange(bundle,e){
  const t = {
    Value: [
      {minEmp:20,maxEmp:50, hrMin:3.41, hrMax:4.27, peMin:1.60, peMax:2.00},
      {minEmp:51,maxEmp:100, hrMin:3.20, hrMax:4.00, peMin:1.28, peMax:1.60},
      {minEmp:101,maxEmp:250, hrMin:2.88, hrMax:3.60, peMin:1.07, peMax:1.33},
      {minEmp:251,maxEmp:500, hrMin:2.56, hrMax:3.20, peMin:0.91, peMax:1.13},
      {minEmp:501,maxEmp:1000, hrMin:2.13, hrMax:2.67, peMin:0.80, peMax:1.00}
    ],
    Advanced: [
      {minEmp:20,maxEmp:50, hrMin:3.84, hrMax:4.80, peMin:1.60, peMax:2.00},
      {minEmp:51,maxEmp:100, hrMin:3.52, hrMax:4.40, peMin:1.28, peMax:1.60},
      {minEmp:101,maxEmp:250, hrMin:3.20, hrMax:4.00, peMin:1.07, peMax:1.33},
      {minEmp:251,maxEmp:500, hrMin:2.88, hrMax:3.60, peMin:0.91, peMax:1.13},
      {minEmp:501,maxEmp:1000, hrMin:2.56, hrMax:3.20, peMin:0.80, peMax:1.00}
    ]
  };
  return (t[bundle] || []).find(r => e >= r.minEmp && e <= r.maxEmp) || null;
}

// =====================
// UPDATE DISCOUNTS
// =====================
function updateDiscounts(){
  const e = Number($("employees").value.replace(/,/g,"")) || 0;
  const bh = $("bundleZenHR").value;
  const ba = $("bundleZenATS").value;

  const hr = +$("hrPrice").value || 0;
  const pe = +$("pePrice").value || 0;
  const ats = Number($("atsPrice").value.replace(/,/g,"")) || 0;
  const ps = Number($("psFees2").value.replace(/,/g,"")) || 0;

  const a = getZenATSRange(ba);
  const p = getImplementationRange(e,bh);

  $("hrDisc").textContent = (hr?((1-hr/8)*100).toFixed(2):"00.00")+"%";
  $("peDisc").textContent = (pe?((1-pe/3)*100).toFixed(2):"00.00")+"%";
  $("atsDisc").textContent = (ats?((1-ats/a.max)*100).toFixed(2):"00.00")+"%";
  $("psDisc").textContent = (ps?((1-ps/p.max)*100).toFixed(2):"00.00")+"%";
}

// =====================
// UPDATE RANGE TABLE
// =====================
function updateRanges(e,bh,ba){
  if(!e || e < 20){
    ["hrMinCell","hrMaxCell","peMinCell","peMaxCell",
     "atsMinCell","atsMaxCell","implMinCell","implMaxCell"]
     .forEach(id => $(id).textContent = "0.00");
    return;
  }
  const r = getRange(bh,e) || {hrMin:0,peMin:0};
  const a = getZenATSRange(ba);
  const p = getImplementationRange(e,bh);

  $("hrMinCell").textContent = fmt(r.hrMin);
  $("peMinCell").textContent = fmt(r.peMin);
  $("atsMinCell").textContent = fmt(a.min);
  $("implMinCell").textContent = fmt(p.min);

  $("hrMaxCell").textContent = fmt(r.hrMin*1.25);
  $("peMaxCell").textContent = fmt(r.peMin*1.25);
  $("atsMaxCell").textContent = fmt(a.max);
  $("implMaxCell").textContent = fmt(p.max);
}

// =====================
// RECALCULATE SUMMARY
// =====================
function recalc(){
  const e = Number($("employees").value.replace(/,/g,"")) || 0;
  const bh = $("bundleZenHR").value;
  const ba = $("bundleZenATS").value;

  const hr  = +$("hrPrice").value || 0;
  const pe  = +$("pePrice").value || 0;
  const ats = Number($("atsPrice").value.replace(/,/g,"")) || 0;
  const ps = Number($("psFees2").value.replace(/,/g,"")) || 0;

  updateRanges(e,bh,ba);
  updateDiscounts();

  // Show/Hide ATS row
  $("atsRow").style.display = (ba === "None") ? "none" : "";

  const yearly = e * (hr + pe) * 12;
  const monthly = yearly / 12;

  const taxBase = yearly + ats + ps;
  const vat = taxBase * (VAT/100);
  const total = taxBase + vat;

  $("monthlySub").textContent = `USD ${fmt(monthly)}`;
  $("yearlySub").textContent  = `USD ${fmt(yearly)}`;
  $("vatAmount").textContent  = `USD ${fmt(vat)}`;
  $("totalWithVat").textContent = `USD ${fmt(total)}`;
  $("totalWithoutVat").textContent = `USD ${fmt(taxBase)}`;

  if(ps > 0){ $("implLine").style.display="block"; $("implAmount").textContent=`USD ${fmt(ps)}`; } else { $("implLine").style.display="none"; }

    // ATS summary line
  if(ba !== "None" && ats > 0){
    $("atsLine").style.display = "block";
    $("atsAmount").textContent = `USD ${fmt(ats)}`;
  } else {
    $("atsLine").style.display = "none";
  }

// Highlight logic
  const el = $("totalWithoutVat");
  el.classList.remove("low-total","high-total");
  if(taxBase < 1000) el.classList.add("low-total");
  else el.classList.add("high-total");

  // If all cleared → reset summary values
  if(!hr && !pe && !ats && !ps){
    $("monthlySub").textContent = "USD 0.00";
    $("yearlySub").textContent = "USD 0.00";
    $("implAmount").textContent = "USD 0.00";
    $("vatAmount").textContent = "USD 0.00";
    $("totalWithVat").textContent = "USD 0.00";
    $("totalWithoutVat").textContent = "USD 0.00";
  }
}

// =====================
// PARTIAL RESET
// (Only fields in "Check Your Proposal")
// =====================
function resetProposalFields(){
  ["hrPrice","pePrice","atsPrice","psFees2"].forEach(id => $(id).value = "");
  clearDiscounts();
  recalc();
}

// =====================
// FULL RESET (Reset button only)
// =====================
function resetAll(){ location.reload(); }

// =====================
// EVENTS
// =====================

// Changing ZenHR → RESET proposal fields
$("bundleZenHR").addEventListener("change",()=>{
  resetProposalFields();
});

// Changing employees → RESET proposal fields
$("employees").addEventListener("change",()=>{
  resetProposalFields();
});

// Changing ZenATS → DO NOT RESET — ONLY RECALCULATE
$("bundleZenATS").addEventListener("change",()=>{
  const b = $("bundleZenATS").value;
  if(b === "None"){
    $("atsPrice").value = "";
  }
  recalc();
});

// Unlock inputs while typing employee number
$("employees").addEventListener("input",()=>{
  const e = Number($("employees").value.replace(/,/g,"")) || 0;
  inputsLock(e < 20);
  recalc();
});

// Validations + blur handlers
$("hrPrice").addEventListener("blur",()=>{
  const e = Number($("employees").value.replace(/,/g,"")) || 0;
  if(!e) return;
  const r = getRange($("bundleZenHR").value,e);
  if(!r) return;
  const v = +$("hrPrice").value;
  if(!v) return;
  if(v < r.hrMin){
    Swal.fire({
      title:'Invalid Value',
      html:`<b>ZenHR Price</b> must be at least <b style="color:#007b83">USD ${fmt(r.hrMin)}</b>.`,
      icon:'warning',
      confirmButtonColor:'#007b83'
    }).then(()=>{$("hrPrice").value="";$("hrPrice").focus();});
  }
  recalc();
});

$("pePrice").addEventListener("blur",()=>{
  const e = Number($("employees").value.replace(/,/g,"")) || 0;
  if(!e) return;
  const r = getRange($("bundleZenHR").value,e);
  if(!r) return;
  const v = +$("pePrice").value;
  if(!v) return;
  if(v < r.peMin){
    Swal.fire({
      title:'Invalid Value',
      html:`<b>ZenPE Price</b> must be at least <b style="color:#007b83">USD ${fmt(r.peMin)}</b>.`,
      icon:'warning',
      confirmButtonColor:'#007b83'
    }).then(()=>{$("pePrice").value="";$("pePrice").focus();});
  }
  recalc();
});

$("atsPrice").addEventListener("blur",()=>{
  const b = $("bundleZenATS").value;
  if(b === "None") return;
  const a = getZenATSRange(b);
  const v = +$("atsPrice").value;
  if(!v) return;
  if(v < a.min){
    Swal.fire({
      title:'Invalid Value',
      html:`<b>ZenATS Price</b> must be at least <b style="color:#007b83">USD ${fmt(a.min)}</b>.`,
      icon:'warning',
      confirmButtonColor:'#007b83'
    }).then(()=>{$("atsPrice").value="";$("atsPrice").focus();});
  }
  recalc();
});

// PS Fees validation
$("psFees2").addEventListener("blur",()=>{
  const e = Number($("employees").value.replace(/,/g,"")) || 0;
  if(!e) return;
  const p = getImplementationRange(e,$("bundleZenHR").value);
  const v = +$("psFees2").value;
  if(!v) return;

  if(v < p.min){
    Swal.fire({
      title:'Invalid Value',
      html:`<b>Implementation / PS Fees</b> must be at least <b style="color:#007b83">USD ${fmt(p.min)}</b>.`,
      icon:'warning',
      confirmButtonColor:'#007b83'
    }).then(()=>{$("psFees2").value="";$("psFees2").focus();});
  }
  recalc();
});

// Inputs recalc live
["hrPrice","pePrice","atsPrice","psFees2"].forEach(id =>
  $(id).addEventListener("input", recalc)
);

// Reset button
$("resetBtn").addEventListener("click", resetAll);

// Change country button
$("changeCountryBtn").onclick = () => { window.location = "index.html"; };

// Init removed
</script></script>

<script>
document.getElementById("country").onchange=function(){
    const c=this.value;
    const map={
        "Saudi Arabia":"KSA.html",
        "UAE":"UAE.html",
        "Qatar":"Qatar.html",
        "Bahrain":"Bahrain.html",
        "Kuwait":"Kuwait.html",
        "Oman":"Oman.html",
        "Jordan":"Jordan.html",
        "Iraq":"Iraq.html",
        "Egypt":"Egypt.html"
    };
    window.location = map[c];
};
</script>


<script>
document.getElementById("employees").addEventListener("blur",function(){
    const e = Number(this.value.replace(/,/g,"")) || 0;
    if(e && e < 20){
        Swal.fire({
            title:'Invalid Input',
            html:'Minimum number of employees is <b style="color:#007b83">20</b>.',
            icon:'warning',
            confirmButtonText:'OK',
            confirmButtonColor:'#007b83'
        }).then(()=>{ this.value=""; this.focus(); });
    }
});
</script>


<script>
function formatNumInput(el){
    let v=el.value.replace(/,/g,'');
    if(!v||isNaN(v)) return;
    let f=Number(v).toLocaleString('en-US', {minimumFractionDigits:2, maximumFractionDigits:2});
    el.value=f;
}

['hrPrice','pePrice','atsPrice','psFees2'].forEach(id=>{
    const el=document.getElementById(id);
    if(el) el.addEventListener('blur',()=>formatNumInput(el));
});
</script>


<script>
document.getElementById("bundleZenATS").addEventListener("change", function(){
    const b = this.value;
    const atsPrice = document.getElementById("atsPrice");
    const atsRow = document.getElementById("atsRow");
    const atsLine = document.getElementById("atsLine");

    atsPrice.value = "";
    atsRow.style.display = (b === "None") ? "none" : "";
    atsLine.style.display = (b === "None") ? "none" : "";
    recalc();
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function(){
    const b = document.getElementById("bundleZenATS").value;
    if(b === "None"){
        document.getElementById("atsRow").style.display = "none";
        document.getElementById("atsLine").style.display = "none";
        document.getElementById("atsPrice").value = "";
    }
});
</script>


<script>
document.addEventListener("input", function(){
    const ps = document.getElementById("psFees2").value.replace(/,/g,'');
    const impl = document.getElementById("implLine");
    if(ps && !isNaN(ps) && Number(ps) > 0){
        impl.style.display = "block";
    } else {
        impl.style.display = "none";
    }
});
</script>


<script>
document.addEventListener("DOMContentLoaded", function(){
    const emp = document.getElementById("employees");
    if(emp){ emp.focus(); }
});
</script>

</body>
</html>
